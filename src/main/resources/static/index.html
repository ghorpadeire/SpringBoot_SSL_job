<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SSL/TLS Assessment Tool</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>

<!-- Simple heading + one line explanation -->
<h1>SSL/TLS Assessment</h1>
<p>Enter a hostname. Server connects on port 443 and shows a simple result.</p>

<!-- Hostname input form: hits /assess with GET and shows plain text result -->
<form action="/assess" method="get">
    <label for="hostname">Hostname:</label>
    <input
            id="hostname"
            type="text"
            name="hostname"
            placeholder="example.com (hostname only, no http, no port)"
            required
    >
    <button type="submit">Run Assessment</button>
</form>
<p>Only hostnames allowed. No IP addresses or custom ports.</p>

<hr>

<!-- Recent assessments controls -->
<h2>Recent assessments</h2>
<p>Last 10 assessed hostnames. Newest first.</p>

<!-- Refresh just reloads this page -->
<button type="button" onclick="location.reload()">Refresh</button>

<!-- Clear all results (POST to /assessments/clear) -->
<form action="/assessments/clear" method="post" style="display:inline;">
    <button type="submit">Clear All</button>
</form>

<!-- Quick link to raw text endpoint for debugging -->
<a href="/recent" style="margin-left:8px;">Open /recent (raw text)</a>

<!-- Recent assessments table. We fill tbody via small JS by calling /recent -->
<table border="1" cellpadding="4" cellspacing="0" style="margin-top:10px;">
    <thead>
    <tr>
        <th>Hostname</th>
        <th>Certificate</th>
        <th>Protocol</th>
        <th>Cipher Suite</th>
        <th>Last Checked</th>
        <th>Actions</th>
    </tr>
    </thead>
    <tbody id="recent-body">
    <tr id="recent-empty"><td colspan="6">Loadingâ€¦</td></tr>
    </tbody>
</table>

<!-- Delete one host quickly using a small form -->
<form action="/assessments/delete" method="post" style="margin-top:12px;">
    <label for="delHost">Delete one hostname:</label>
    <input id="delHost" type="text" name="hostname" placeholder="example.com" required>
    <button type="submit">Delete</button>
</form>

<noscript>
    <p><strong>Note:</strong> Enable JavaScript to see the table fill automatically. You can still open <a href="/recent">/recent</a> to view plain text.</p>
</noscript>

<script>
    // Small helper: fetch "/recent" which returns plain text like:
    // Recent (newest first):
    // example.com | valid | TLSv1.3 | TLS_AES_256_GCM_SHA384 | 2025-11-12T12:34:56Z
    // We parse each non-empty line after the header and build table rows.

    async function loadRecent() {
        const tbody = document.getElementById('recent-body');
        const emptyRow = document.getElementById('recent-empty');

        try {
            const res = await fetch('/recent', {cache: 'no-store'});
            const text = await res.text();

            // Split into lines and drop the header line
            const lines = text.split('\n').map(s => s.trim());
            // Expect first line to start with "Recent (newest first):"
            const dataLines = lines.filter((line, idx) =>
                line.length > 0 && !(idx === 0 && line.toLowerCase().startsWith('recent'))
            );

            // Clear placeholder row
            if (emptyRow) emptyRow.remove();

            if (dataLines.length === 0) {
                const tr = document.createElement('tr');
                const td = document.createElement('td');
                td.colSpan = 6;
                td.textContent = '(empty)';
                tr.appendChild(td);
                tbody.appendChild(tr);
                return;
            }

            for (const line of dataLines) {
                // Expected format with 5 parts separated by " | "
                // [0]=host, [1]=valid/invalid, [2]=protocol or null, [3]=cipher or null, [4]=timestamp
                const parts = line.split(' | ');
                if (parts.length < 5) continue; // skip unexpected lines

                const host = parts[0] || '';
                const cert = parts[1] || '';
                const proto = parts[2] || '';
                const cipher = parts[3] || '';
                const ts = parts[4] || '';

                const tr = document.createElement('tr');

                // Hostname with link to /results
                const tdHost = document.createElement('td');
                const a = document.createElement('a');
                a.href = '/results?hostname=' + encodeURIComponent(host);
                a.textContent = host;
                tdHost.appendChild(a);

                const tdCert = document.createElement('td'); tdCert.textContent = cert;
                const tdProto = document.createElement('td'); tdProto.textContent = proto;
                const tdCipher = document.createElement('td'); tdCipher.textContent = cipher;
                const tdTs = document.createElement('td'); tdTs.textContent = ts;

                // Actions: a small form that posts to /assessments/delete
                const tdAct = document.createElement('td');
                const form = document.createElement('form');
                form.action = '/assessments/delete';
                form.method = 'post';
                form.style.display = 'inline';

                const hidden = document.createElement('input');
                hidden.type = 'hidden';
                hidden.name = 'hostname';
                hidden.value = host;

                const btn = document.createElement('button');
                btn.type = 'submit';
                btn.textContent = 'Delete';

                form.appendChild(hidden);
                form.appendChild(btn);
                tdAct.appendChild(form);

                tr.appendChild(tdHost);
                tr.appendChild(tdCert);
                tr.appendChild(tdProto);
                tr.appendChild(tdCipher);
                tr.appendChild(tdTs);
                tr.appendChild(tdAct);

                tbody.appendChild(tr);
            }
        } catch (e) {
            // On error, show a friendly message
            if (emptyRow) emptyRow.remove();
            const tr = document.createElement('tr');
            const td = document.createElement('td');
            td.colSpan = 6;
            td.textContent = 'Could not load /recent. You can open it directly to debug.';
            tr.appendChild(td);
            tbody.appendChild(tr);
        }
    }

    loadRecent();
</script>

</body>
</html>
